import{m as r,n as l}from"./app.7c1229c4.js";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page-approve"},[s("PageTitle",{attrs:{title:t.$L("\u5BA1\u6279")}}),s("div",{ref:"fileWrapper",staticClass:"approve-wrapper"},[s("div",{staticClass:"approve-head"},[s("div",{staticClass:"approve-nav"},[s("h1",[t._v(t._s(t.$L("\u5BA1\u6279")))])])]),s("div",{staticClass:"approve-search"},[s("Input",{attrs:{suffix:"ios-search",placeholder:t.$L("\u8BF7\u9009\u62E9\u9879\u76EE\u540D\u79F0")},on:{"on-change":t.getLists},model:{value:t.project,callback:function(a){t.project=a},expression:"project"}}),s("Input",{attrs:{suffix:"ios-search",placeholder:t.$L("\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0")},on:{"on-change":t.getLists},model:{value:t.searchKey,callback:function(a){t.searchKey=a},expression:"searchKey"}})],1),s("div",{staticClass:"approve-table"},[s("div",{staticClass:"table-page-box"},[s("Table",{attrs:{columns:t.columns,data:t.lists,loading:t.loadIng>0,"no-data-text":t.$L(t.noDataText),stripe:""}}),s("Page",{attrs:{total:t.listTotal,current:t.listPage,"page-size":t.listPageSize,disabled:t.loadIng>0,simple:"","page-size-opts":[10,20,30,50,100],"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)])]),s("Modal",{attrs:{title:t.$L("\u62D2\u7EDD\u7533\u8BF7"),"mask-closable":!1},model:{value:t.refuseShow,callback:function(a){t.refuseShow=a},expression:"refuseShow"}},[s("Form",{ref:"addDelay",attrs:{model:t.formData,rules:t.refuseRule,"label-width":"auto"},nativeOn:{submit:function(a){a.preventDefault()}}},[s("FormItem",{staticStyle:{"margin-bottom":"10px"},attrs:{prop:"refuseReason",label:t.$L("\u62D2\u7EDD\u539F\u56E0")}},[s("Input",{attrs:{type:"textarea"},model:{value:t.formData.refuseReason,callback:function(a){t.$set(t.formData,"refuseReason",a)},expression:"formData.refuseReason"}})],1)],1),s("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"default"},on:{click:t.cancel}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),s("Button",{attrs:{type:"primary",loading:t.loadIng>0},on:{click:t.refuse}},[t._v(t._s(t.$L("\u786E\u5B9A")))])],1)],1)],1)},o=[];const c={name:"approve",computed:{...r(["userId","wsMsg"])},data(){return{searchKey:"",columns:[{title:this.$L("\u9879\u76EE\u540D\u79F0"),width:120,render:(t,{row:e})=>{var s;return t("span",((s=e.project)==null?void 0:s.name)||"")}},{title:this.$L("\u4EFB\u52A1\u540D\u79F0"),align:"center",width:120,render:(t,{row:e})=>{var s;return t("span",((s=e.project_task)==null?void 0:s.name)||"")}},{title:this.$L("\u53D1\u8D77\u4EBA"),align:"center",width:120,render:(t,{row:e})=>{var s;return t("span",((s=e.user)==null?void 0:s.nickname)||"")}},{title:this.$L("\u6539\u671F\u65F6\u95F4"),align:"center",width:120,render:(t,{row:e})=>t("span",e.days+this.$L("\u5929")||"")},{title:this.$L("\u5BA1\u6279\u72B6\u6001"),align:"center",width:120,render:(t,{row:e})=>t("span",this.statusR(e.status))},{title:this.$L("\u5BA1\u6279\u4EBA"),align:"center",width:120,render:(t,{row:e})=>{var s;return t("span",((s=e.audit_user)==null?void 0:s.nickname)||"-")}},{title:this.$L("\u7533\u8BF7\u539F\u56E0"),align:"center",width:120,render:(t,{row:e})=>t("span",e.reason||"-")},{title:this.$L("\u62D2\u7EDD\u7406\u7531"),align:"center",width:120,render:(t,{row:e})=>t("span",e.status_reason||"-")},{title:this.$L("\u64CD\u4F5C"),align:"center",width:100,minWidth:100,render:(t,{row:e})=>{let s=[];return s.push(t("Icon",{props:{type:"md-checkmark-circle"},style:{color:e.status!="0"||e.audit_userid!=this.userId?"#6b6e72":"#84c56a",opacity:e.status!="0"||e.audit_userid!=this.userId?"0.3":"",cursor:e.status!="0"||e.audit_userid!=this.userId?"not-allowed":"pointer",marginRight:"12px",fontSize:"18px"},on:{click:()=>{if(e.status!="0"||e.audit_userid!=this.userId)return null;this.pass(e)}}})),s.push(t("Icon",{props:{type:"md-close-circle"},style:{color:e.status!="0"||e.audit_userid!=this.userId?"#6b6e72":"#ed4014",opacity:e.status!="0"||e.audit_userid!=this.userId?"0.3":"",cursor:e.status!="0"||e.audit_userid!=this.userId?"not-allowed":"pointer",fontSize:"18px"},on:{click:()=>{if(e.status!="0"||e.audit_userid!=this.userId)return null;this.refuseId=e.id,this.refuseShow=!0}}})),t("div",s)}}],loadIng:0,listTotal:0,listPage:1,listPageSize:10,noDataText:this.$L("\u6CA1\u6709\u76F8\u5173\u7684\u6570\u636E"),lists:[],refuseId:"",refuseShow:!1,formData:{refuseReason:""},refuseRule:{refuseReason:[{required:!0,message:this.$L("\u8BF7\u586B\u5199\u62D2\u7EDD\u539F\u56E0\uFF01"),trigger:"change"}]},projectPage:1,project:"",projectList:[],next_page_url:null}},watch:{wsMsg:{handler(t){const{type:e,action:s}=t;switch(e){case"approve":s=="backlog"&&(clearInterval(this.setTimeoutbacklogIndex||0),this.setTimeoutbacklogIndex=setTimeout(()=>{this.getLists()},500));break}},deep:!0}},activated(){this.getLists(),this.remoteMethodClear("")},methods:{getLists(){this.loadIng++,this.$store.dispatch("call",{url:"project/task/applyList",data:{task_name:this.searchKey,project_name:this.project,page:this.listPage,pagesize:this.listPageSize}}).then(({data:t})=>{this.loadIng--,this.lists=t.data,this.listTotal=t.total,this.next_page_url=t.next_page_url,this.noDataText="\u6CA1\u6709\u76F8\u5173\u7684\u6570\u636E"}).catch(()=>{this.loadIng--,this.noDataText="\u6570\u636E\u52A0\u8F7D\u5931\u8D25"})},pass(t){$A.modalConfirm({title:"\u901A\u8FC7\u5BA1\u6838",content:"\u662F\u5426\u901A\u8FC7\u8FD9\u6761\u4EFB\u52A1\u7684\u5EF6\u671F\uFF1F",onOk:()=>{this.loadIng++,this.$store.dispatch("call",{url:"project/task/delayApprove",data:{id:t.id,pass:!0}}).then(({msg:e})=>{this.loadIng--,$A.messageSuccess(e)}).catch(({msg:e})=>{$A.messageError(e),this.loadIng--})}})},cancel(){this.formData.refuseReason="",this.refuseId="",this.refuseShow=!1},refuse(){this.formData.refuseReason!=""&&(this.loadIng++,this.$store.dispatch("call",{url:"project/task/delayApprove",data:{id:this.refuseId,reason:this.formData.refuseReason,pass:!1}}).then(({msg:t})=>{$A.messageSuccess(t),this.loadIng--,this.cancel()}).catch(({msg:t})=>{$A.messageError(t),this.loadIng--}))},statusR(t){let e="";switch(t){case 0:e=this.$L("\u5F85\u5BA1\u6838");break;case 1:e=this.$L("\u901A\u8FC7");break;case 2:e=this.$L("\u62D2\u7EDD");break}return e},setPage(t){this.listPage=t,this.getLists()},setPageSize(t){Math.max($A.runNum(this.listPageSize),10)!==t&&(this.listPageSize=t,this.getLists())},remoteMethod(t){t!==""?(this.loadIng++,this.projectPage=1,this.$store.dispatch("call",{url:"project/personal/list",data:{type:"all",keyword:t,page:this.projectPage,pagesize:20}}).then(({data:e})=>{this.loadIng--,this.projectList=e.data,this.next_page_url=e.next_page_url}).catch(()=>{this.loadIng--})):this.project=""},remoteMethodClear(t){t==""&&(this.loadIng++,this.projectPage=1,this.$store.dispatch("call",{url:"project/personal/list",data:{type:"all",keyword:t,page:this.projectPage,pagesize:20}}).then(({data:e})=>{this.loadIng--,this.projectList=e.data,this.next_page_url=e.next_page_url}).catch(()=>{this.loadIng--}))},moreProject(){this.loadIng++,this.projectPage++,this.$store.dispatch("call",{url:"project/personal/list",data:{type:"all",page:this.projectPage,pagesize:20}}).then(({data:t})=>{this.loadIng--,t.data.forEach(e=>{this.projectList.push(e)}),this.next_page_url=t.next_page_url}).catch(()=>{this.loadIng--})}}},i={};var h=l(c,n,o,!1,u,null,null,null);function u(t){for(let e in i)this[e]=i[e]}var d=function(){return h.exports}();export{d as default};
