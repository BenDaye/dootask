import{n as d,N as j,m as h,b as v,a as u,U as M,c as k}from"./app.350b47a4.js";import{C as N,R as P,T as R}from"./CheckinExport.60843854.js";import{D as E}from"./index.7550aca7.js";import{T as U,a as B,b as O}from"./TaskDetail.c7ce3047.js";import{M as F}from"./MeetingManager.158f0224.js";import{l as z}from"./longpress.43ca7fd9.js";import{D as V}from"./DialogWrapper.36672b4b.js";import{A as H}from"./ApproveExport.b4f24cb9.js";import{M as W}from"./MicroApps.da371cc8.js";import"./ReportEdit.8b23c265.js";import"./ReportDetail.dcafeff1.js";import"./ProjectLog.8b51d3e2.js";import"./TEditor.bc76d4e1.js";import"./ImgUpload.07949915.js";import"./details.c6734780.js";var K=function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"project-archived"},[a("div",{staticClass:"archived-title"},[t._v(" "+t._s(t.$L("\u5F52\u6863\u7684\u9879\u76EE"))+" "),a("div",{staticClass:"title-icon"},[t.loadIng>0?a("Loading"):t._e()],1)]),a("div",{staticClass:"search-container lr"},[a("ul",[a("li",[a("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u9879\u76EE\u540D"))+" ")]),a("div",{staticClass:"search-content"},[a("Input",{attrs:{clearable:""},model:{value:t.keys.name,callback:function(e){t.$set(t.keys,"name",e)},expression:"keys.name"}})],1)]),a("li",{staticClass:"search-button"},[a("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[a("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.onSearch}},[t._v(t._s(t.$L("\u641C\u7D22")))]),a("div",{attrs:{slot:"content"},slot:"content"},[t.keyIs?a("Button",{attrs:{type:"text"},on:{click:function(e){t.keyIs=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88\u7B5B\u9009")))]):a("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("\u5237\u65B0")))])],1)],1)],1)])]),a("div",{staticClass:"table-page-box"},[a("Table",{attrs:{columns:t.columns,data:t.list,loading:t.loadIng>0,"no-data-text":t.$L(t.noText),stripe:""}}),a("Page",{attrs:{total:t.total,current:t.page,"page-size":t.pageSize,disabled:t.loadIng>0,simple:t.windowPortrait,"page-size-opts":[10,20,30,50,100],"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)])},Y=[];const q={name:"ProjectArchived",data(){return{loadIng:0,keys:{},keyIs:!1,columns:[{title:"ID",key:"id",width:80,render:(t,{row:s,column:a})=>t("TableAction",{props:{column:a,align:"left"}},[t("div",s.id)])},{title:this.$L("\u9879\u76EE\u540D\u79F0"),key:"name",minWidth:200,render:(t,{row:s})=>t("AutoTip",s.name)},{title:this.$L("\u5F52\u6863\u65F6\u95F4"),key:"archived_at",width:168},{title:this.$L("\u5F52\u6863\u4EBA\u5458"),key:"archived_userid",minWidth:80,render:(t,{row:s})=>s.archived_userid?t("UserAvatar",{props:{userid:s.archived_userid,size:24,showName:!0}}):t("Tag",this.$L("\u7CFB\u7EDF\u81EA\u52A8"))},{title:this.$L("\u8D1F\u8D23\u4EBA"),minWidth:80,render:(t,{row:s})=>t("UserAvatar",{props:{showName:!0,size:22,userid:s.owner_userid}})},{title:this.$L("\u64CD\u4F5C"),align:"center",width:100,render:(t,s)=>{const a=[t("Poptip",{props:{title:this.$L("\u4F60\u786E\u5B9A\u8981\u8FD8\u539F\u5F52\u6863\u5417\uFF1F"),confirm:!0,transfer:!0,placement:"left",okText:this.$L("\u786E\u5B9A"),cancelText:this.$L("\u53D6\u6D88")},style:{fontSize:"13px",cursor:"pointer",color:"#84C56A"},on:{"on-ok":()=>{this.recovery(s.row)}}},this.$L("\u8FD8\u539F")),t("Poptip",{props:{title:this.$L("\u4F60\u786E\u5B9A\u8981\u5220\u9664\u9879\u76EE\u5417\uFF1F"),confirm:!0,transfer:!0,placement:"left",okText:this.$L("\u786E\u5B9A"),cancelText:this.$L("\u53D6\u6D88")},style:{marginLeft:"8px",fontSize:"13px",cursor:"pointer",color:"#f00"},on:{"on-ok":()=>{this.delete(s.row)}}},this.$L("\u5220\u9664"))];return t("TableAction",{props:{column:s.column}},a)}}],list:[],page:1,pageSize:20,total:0,noText:""}},mounted(){this.getLists()},watch:{keyIs(t){t||(this.keys={},this.setPage(1))}},methods:{onSearch(){this.page=1,this.getLists()},getLists(){this.loadIng++,this.keyIs=$A.objImplode(this.keys)!="",this.$store.dispatch("call",{url:"project/lists",data:{keys:this.keys,archived:"yes",page:Math.max(this.page,1),pagesize:Math.max($A.runNum(this.pageSize),10)}}).then(({data:t})=>{this.page=t.current_page,this.total=t.total,this.list=t.data,this.noText="\u6CA1\u6709\u76F8\u5173\u7684\u6570\u636E"}).catch(()=>{this.noText="\u6570\u636E\u52A0\u8F7D\u5931\u8D25"}).finally(t=>{this.loadIng--})},setPage(t){this.page=t,this.getLists()},setPageSize(t){this.page=1,this.pageSize=t,this.getLists()},recovery(t){this.list=this.list.filter(({id:s})=>s!=t.id),this.loadIng++,this.$store.dispatch("call",{url:"project/archived",data:{project_id:t.id,type:"recovery"}}).then(()=>{this.getLists(),this.$store.dispatch("getProjectOne",t.id).catch(()=>{})}).catch(({msg:s})=>{$A.modalError(s),this.getLists()}).finally(s=>{this.loadIng--})},delete(t){this.list=this.list.filter(({id:s})=>s!=t.id),this.loadIng++,this.$store.dispatch("removeProject",t.id).then(({msg:s})=>{$A.messageSuccess(s),this.getLists()}).catch(({msg:s})=>{$A.modalError(s),this.getLists()}).finally(s=>{this.loadIng--})}}},$={};var G=d(q,K,Y,!1,J,null,null,null);function J(t){for(let s in $)this[s]=$[s]}var X=function(){return G.exports}(),Q=function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"project-management"},[a("div",{staticClass:"management-title"},[t._v(" "+t._s(t.$L("\u6240\u6709\u9879\u76EE"))+" "),a("div",{staticClass:"title-icon"},[t.loadIng>0?a("Loading"):t._e()],1)]),a("div",{staticClass:"search-container lr"},[a("ul",[a("li",[a("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u9879\u76EE\u540D"))+" ")]),a("div",{staticClass:"search-content"},[a("Input",{attrs:{clearable:""},model:{value:t.keys.name,callback:function(e){t.$set(t.keys,"name",e)},expression:"keys.name"}})],1)]),a("li",[a("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u9879\u76EE\u7C7B\u578B"))+" ")]),a("div",{staticClass:"search-content"},[a("Select",{attrs:{placeholder:t.$L("\u56E2\u961F\u9879\u76EE")},model:{value:t.keys.type,callback:function(e){t.$set(t.keys,"type",e)},expression:"keys.type"}},[a("Option",{attrs:{value:""}},[t._v(t._s(t.$L("\u56E2\u961F\u9879\u76EE")))]),a("Option",{attrs:{value:"personal"}},[t._v(t._s(t.$L("\u4E2A\u4EBA\u9879\u76EE")))]),a("Option",{attrs:{value:"all"}},[t._v(t._s(t.$L("\u5168\u90E8\u9879\u76EE")))])],1)],1)]),a("li",[a("div",{staticClass:"search-label"},[t._v(" "+t._s(t.$L("\u9879\u76EE\u72B6\u6001"))+" ")]),a("div",{staticClass:"search-content"},[a("Select",{attrs:{placeholder:t.$L("\u672A\u5F52\u6863")},model:{value:t.keys.status,callback:function(e){t.$set(t.keys,"status",e)},expression:"keys.status"}},[a("Option",{attrs:{value:""}},[t._v(t._s(t.$L("\u672A\u5F52\u6863")))]),a("Option",{attrs:{value:"archived"}},[t._v(t._s(t.$L("\u5DF2\u5F52\u6863")))]),a("Option",{attrs:{value:"all"}},[t._v(t._s(t.$L("\u5168\u90E8")))])],1)],1)]),a("li",{staticClass:"search-button"},[a("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[a("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.onSearch}},[t._v(t._s(t.$L("\u641C\u7D22")))]),a("div",{attrs:{slot:"content"},slot:"content"},[t.keyIs?a("Button",{attrs:{type:"text"},on:{click:function(e){t.keyIs=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88\u7B5B\u9009")))]):a("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("\u5237\u65B0")))])],1)],1)],1)])]),a("div",{staticClass:"table-page-box"},[a("Table",{attrs:{columns:t.columns,data:t.list,loading:t.loadIng>0,"no-data-text":t.$L(t.noText),stripe:""}}),a("Page",{attrs:{total:t.total,current:t.page,"page-size":t.pageSize,disabled:t.loadIng>0,simple:t.windowPortrait,"page-size-opts":[10,20,30,50,100],"show-elevator":"","show-sizer":"","show-total":""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)])},Z=[];const tt={name:"ProjectManagement",data(){return{loadIng:0,keys:{},keyIs:!1,columns:[{title:"ID",key:"id",width:80,render:(t,{row:s,column:a})=>t("TableAction",{props:{column:a,align:"left"}},[t("div",s.id)])},{title:this.$L("\u9879\u76EE\u540D\u79F0"),key:"name",minWidth:100,render:(t,{row:s})=>{const a=[t("AutoTip",s.name)];return s.archived_at&&a.push(t("Tag",{props:{color:"error"}},this.$L("\u5DF2\u5F52\u6863"))),t("div",{class:"project-name"},a)}},{title:this.$L("\u9879\u76EE\u8FDB\u5EA6"),minWidth:100,render:(t,{row:s})=>{const a=[t("AutoTip",s.task_complete+"/"+s.task_num),t("Progress",{props:{percent:s.task_percent,strokeWidth:5}})];return t("div",{class:"project-percent"},a)}},{title:this.$L("\u8D1F\u8D23\u4EBA"),minWidth:80,render:(t,{row:s})=>t("UserAvatar",{props:{showName:!0,size:22,userid:s.owner_userid}})},{title:this.$L("\u521B\u5EFA\u4EBA"),minWidth:80,render:(t,{row:s})=>t("UserAvatar",{props:{showName:!0,size:22,userid:s.userid}})},{title:this.$L("\u521B\u5EFA\u65F6\u95F4"),key:"created_at",width:168}],list:[],page:1,pageSize:20,total:0,noText:""}},mounted(){this.getLists()},watch:{keyIs(t){t||(this.keys={},this.setPage(1))}},methods:{onSearch(){this.page=1,this.getLists()},getLists(){let t="team";this.keys.type=="all"?t="all":this.keys.type=="personal"&&(t="personal");let s="no";this.keys.status=="all"?s="all":this.keys.status=="archived"&&(s="yes"),this.loadIng++,this.keyIs=$A.objImplode(this.keys)!="",this.$store.dispatch("call",{url:"project/lists",data:{keys:this.keys,all:1,archived:s,type:t,page:Math.max(this.page,1),pagesize:Math.max($A.runNum(this.pageSize),10)}}).then(({data:a})=>{this.page=a.current_page,this.total=a.total,this.list=a.data,this.noText="\u6CA1\u6709\u76F8\u5173\u7684\u6570\u636E"}).catch(()=>{this.noText="\u6570\u636E\u52A0\u8F7D\u5931\u8D25"}).finally(a=>{this.loadIng--})},setPage(t){this.page=t,this.getLists()},setPageSize(t){this.page=1,this.pageSize=t,this.getLists()}}},w={};var et=d(tt,Q,Z,!1,at,null,null,null);function at(t){for(let s in w)this[s]=w[s]}var st=function(){return et.exports}(),it=function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"mobile-tabbar"},[t.windowPortrait?a("NetworkException",{attrs:{type:"alert"}}):t._e(),a("transition",{attrs:{name:"mobile-fade"}},[t.isMore?a("div",{staticClass:"more-mask",on:{click:function(e){return t.toggleRoute("more")}}}):t._e()]),a("transition",{attrs:{name:"mobile-slide"}},[t.isMore?a("div",{staticClass:"more-box"},[a("div",{staticClass:"tabbar-more-title"},[t._v(t._s(t.$L("\u66F4\u591A")))]),t._l(t.navMore,function(e){return a("ul",t._l(e,function(n){return a("li",{class:{active:t.activeName===n.name},on:{click:function(i){return t.toggleRoute(n.name)}}},[a("div",{staticClass:"more-item"},[a("i",{staticClass:"taskfont",domProps:{innerHTML:t._s(n.icon)}}),a("div",{staticClass:"tabbar-title"},[t._v(t._s(t.$L(n.label)))]),n.name==="workReport"?a("Badge",{staticClass:"tabbar-badge",attrs:{"overflow-count":999,count:t.reportUnreadNumber+t.approveUnreadNumber}}):t._e()],1)])}),0)})],2):t._e()]),a("ul",{staticClass:"tabbar-box"},t._l(t.navList,function(e){return a("li",{class:{active:t.activeName===e.name},on:{click:function(n){return t.toggleRoute(e.name)}}},[a("i",{staticClass:"taskfont",domProps:{innerHTML:t._s(e.icon)}}),a("div",{staticClass:"tabbar-title"},[t._v(t._s(t.$L(e.label)))]),e.name==="dashboard"?[t.dashboardTask.overdue_count>0?a("Badge",{staticClass:"tabbar-badge",attrs:{type:"error","overflow-count":999,count:t.dashboardTask.overdue_count}}):t.dashboardTask.today_count>0?a("Badge",{staticClass:"tabbar-badge",attrs:{type:"info","overflow-count":999,count:t.dashboardTask.today_count}}):t.dashboardTask.all_count>0?a("Badge",{staticClass:"tabbar-badge",attrs:{type:"primary","overflow-count":999,count:t.dashboardTask.all_count}}):t._e()]:e.name==="dialog"?[a("Badge",{staticClass:"tabbar-badge",attrs:{"overflow-count":999,text:t.msgUnreadMention}})]:e.name==="application"?[a("Badge",{staticClass:"tabbar-badge",attrs:{"overflow-count":999,count:t.reportUnreadNumber+t.approveUnreadNumber}})]:e.name==="more"?[a("Badge",{staticClass:"tabbar-badge",attrs:{"overflow-count":999,count:t.reportUnreadNumber+t.approveUnreadNumber}})]:t._e()],2)}),0),a("Modal",{attrs:{title:t.$L("\u626B\u7801\u767B\u5F55"),"mask-closable":!1},model:{value:t.scanLoginShow,callback:function(e){t.scanLoginShow=e},expression:"scanLoginShow"}},[a("div",{staticClass:"mobile-scan-login-box"},[a("div",{staticClass:"mobile-scan-login-title"},[t._v(t._s(t.$L("\u4F60\u597D\uFF0C\u626B\u7801\u786E\u8BA4\u767B\u5F55")))]),a("div",{staticClass:"mobile-scan-login-subtitle"},[t._v("\u300C"+t._s(t.$L("\u4E3A\u786E\u4FDD\u5E10\u53F7\u5B89\u5168\uFF0C\u8BF7\u786E\u8BA4\u662F\u672C\u4EBA\u64CD\u4F5C"))+"\u300D")])]),a("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default"},on:{click:function(e){t.scanLoginShow=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88\u767B\u5F55")))]),a("Button",{attrs:{type:"primary",loading:t.scanLoginLoad},on:{click:t.scanLoginSubmit}},[t._v(t._s(t.$L("\u786E\u8BA4\u767B\u5F55")))])],1)])],1)},ot=[];const nt={name:"MobileTabbar",components:{NetworkException:j},data(){return{isMore:!1,navList:[{icon:"&#xe6fb;",name:"dashboard",label:"\u4EEA\u8868\u76D8"},{icon:"&#xe6fa;",name:"project",label:"\u9879\u76EE"},{icon:"&#xe6eb;",name:"dialog",label:"\u6D88\u606F"},{icon:"&#xe6b2;",name:"contacts",label:"\u901A\u8BAF\u5F55"},{icon:"&#xe60c;",name:"application",label:"\u5E94\u7528"}],navMore:[[{icon:"&#xe6f5;",name:"calendar",label:"\u65E5\u5386"},{icon:"&#xe6f3;",name:"file",label:"\u6587\u4EF6"},{icon:"&#xe67b;",name:"setting",label:"\u8BBE\u7F6E"}],[{icon:"&#xe7b9;",name:"addProject",label:"\u521B\u5EFA\u9879\u76EE"},{icon:"&#xe7b8;",name:"addTask",label:"\u6DFB\u52A0\u4EFB\u52A1"},{icon:"&#xe7c1;",name:"createMeeting",label:"\u65B0\u4F1A\u8BAE"},{icon:"&#xe794;",name:"joinMeeting",label:"\u52A0\u5165\u4F1A\u8BAE"}],[{icon:"&#xe7da;",name:"workReport",label:"\u5DE5\u4F5C\u62A5\u544A"},{icon:"&#xe7b9;",name:"approve",label:"\u5BA1\u6279\u4E2D\u5FC3"},{icon:"&#xe7b9;",name:"okrManage",label:"OKR\u7BA1\u7406"}]],scanLoginShow:!1,scanLoginLoad:!1,scanLoginCode:""}},created(){$A.isEEUiApp&&this.navMore[0].splice(2,0,{icon:"&#xe602;",name:"scan",label:"\u626B\u4E00\u626B"}),this.userIsAdmin&&(this.navMore[2].splice(0,0,{icon:"&#xe63f;",name:"allUser",label:"\u56E2\u961F\u7BA1\u7406"}),this.navMore[2].push({icon:"&#xe7b9;",name:"okrAnalyze",label:"OKR\u7ED3\u679C"}))},mounted(){},beforeDestroy(){},computed:{...h(["userIsAdmin","cacheDialogs","reportUnreadNumber","approveUnreadNumber"]),...v(["dashboardTask"]),routeName(){return this.$route.name},msgUnreadMention(){let t=0,s=0;this.cacheDialogs.some(e=>{t+=$A.getDialogUnread(e,!1),s+=$A.getDialogMention(e)}),t>999&&(t="999+"),s>999&&(s="999+");const a=this.msgTodoTotal;return a?s?`@${s}\xB7${a}`:t?`${t}\xB7${a}`:a:t?s?`${t}\xB7@${s}`:String(t):s?`@${s}`:""},msgAllUnread(){let t=0;return this.cacheDialogs.some(s=>{t+=$A.getDialogNum(s)}),t},msgTodoTotal(){let t=this.cacheDialogs.reduce((s,a)=>s+(a.todo_num||0),0);return t>0?(t>999?t="999+":t===1&&(t=""),`${this.$L("\u5F85\u529E")}${t}`):null},unreadAndOverdue(){return this.userId>0?this.msgAllUnread+this.dashboardTask.overdue_count:0},activeName(){return this.isMore||["manage-calendar","manage-file","manage-setting","manage-application","manage-approve","manage-apps"].includes(this.routeName)?"application":this.routeName==="manage-dashboard"?"dashboard":this.routeName==="manage-project"&&!/^\d+$/.test(this.$route.params.projectId)?"project":this.routeName==="manage-messenger"?this.$route.params.dialogAction==="contacts"?"contacts":"dialog":""}},watch:{windowActive(t){t||$A.eeuiAppSendMessage({action:"setBdageNotify",bdage:this.unreadAndOverdue})}},methods:{toggleRoute(t){this.$emit("on-click",t),t!="more"&&(this.isMore=!1);let s;switch(t){case"more":this.isMore=!this.isMore;return;case"scan":$A.eeuiAppScan(this.scanResult);return;case"addTask":case"addProject":case"allUser":case"workReport":return;case"createMeeting":u.Store.set("addMeeting",{type:"create",userids:[this.userId]});break;case"joinMeeting":u.Store.set("addMeeting",{type:"join"});break;case"project":s={name:"manage-project",params:{projectId:"all"}};break;case"dialog":s={name:"manage-messenger",params:{dialogAction:"dialog"}},this.routeName==="manage-messenger"&&u.Store.set("clickAgainDialog",!0);break;case"contacts":s={name:"manage-messenger",params:{dialogAction:"contacts"}};break;case"okrManage":case"okrAnalyze":this.goForward({path:"/manage/apps/"+(t=="okrManage"?"/#/list":"/#/analysis"),query:{baseUrl:this.okrUrl}});return;default:s={name:"manage-"+t};break}this.goForward(s)},scanResult(t){const s=(t+"").match(/^https*:\/\/(.*?)\/login\?qrcode=(.*?)$/);if(s){this.scanLoginCode=s[2],this.scanLoginShow=!0;return}/^https*:\/\//i.test(t)&&$A.eeuiAppOpenPage({pageType:"app",pageTitle:" ",url:"web.js",params:{url:t,browser:!0,showProgress:!0}})},scanLoginSubmit(){this.scanLoginLoad!==!0&&(this.scanLoginLoad=!0,this.$store.dispatch("call",{url:"users/login/qrcode",data:{type:"login",code:this.scanLoginCode}}).then(({msg:t})=>{this.scanLoginShow=!1,$A.messageSuccess(t)}).catch(({msg:t})=>{$A.messageError(t)}).finally(t=>{this.scanLoginLoad=!1}))}}},y={};var rt=d(nt,it,ot,!1,lt,null,null,null);function lt(t){for(let s in y)this[s]=y[s]}var ct=function(){return rt.exports}(),dt=function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"task-add"},[a("div",{staticClass:"head",class:{empty:t.addData.cascader.length==0,visible:t.cascaderShow}},[a("Cascader",{attrs:{data:t.cascaderData,clearable:!1,placeholder:t.$L("\u8BF7\u9009\u62E9\u9879\u76EE"),"load-data":t.cascaderLoadData,filterable:""},on:{"on-change":t.cascaderChange,"on-input-change":t.cascaderInputChange,"on-visible-change":function(e){t.cascaderShow=!t.cascaderShow}},model:{value:t.addData.cascader,callback:function(e){t.$set(t.addData,"cascader",e)},expression:"addData.cascader"}})],1),a("div",{staticClass:"task-add-form"},[a("div",{staticClass:"title"},[a("Input",{ref:"input",attrs:{type:"textarea",rows:1,autosize:{minRows:1,maxRows:8},maxlength:255,placeholder:t.$L("\u4EFB\u52A1\u63CF\u8FF0"),enterkeyhint:"done"},on:{"on-keydown":t.onKeydown},model:{value:t.addData.name,callback:function(e){t.$set(t.addData,"name",e)},expression:"addData.name"}})],1),a("TEditorTask",{staticClass:"desc",attrs:{placeholder:t.$L(t.windowLandscape?"\u8BE6\u7EC6\u63CF\u8FF0\uFF0C\u9009\u586B...\uFF08\u70B9\u51FB\u53F3\u952E\u4F7F\u7528\u5DE5\u5177\u680F\uFF09":"\u8BE6\u7EC6\u63CF\u8FF0\uFF0C\u9009\u586B..."),placeholderFull:t.$L("\u8BE6\u7EC6\u63CF\u8FF0...")},model:{value:t.addData.content,callback:function(e){t.$set(t.addData,"content",e)},expression:"addData.content"}}),a("div",{staticClass:"advanced-option",class:{"advanced-open":t.advanced}},[a("Button",{on:{click:function(e){t.advanced=!t.advanced}}},[t._v(t._s(t.$L("\u9AD8\u7EA7\u9009\u9879")))]),a("ul",{staticClass:"advanced-priority"},t._l(t.taskPriority,function(e,n){return a("li",{key:n},[a("ETooltip",{attrs:{disabled:t.$isEEUiApp||t.windowTouch,content:t.taskPriorityContent(e)}},[a("i",{staticClass:"taskfont",style:{color:e.color},domProps:{innerHTML:t._s(t.addData.p_name==e.name?"&#xe61d;":"&#xe61c;")},on:{click:function(i){return t.choosePriority(e)}}})])],1)}),0),t.taskDays>0?a("DatePicker",{attrs:{open:t.taskTimeOpen,options:t.timeOptions,placeholder:t.$L("\u9009\u62E9\u8BA1\u5212\u8303\u56F4"),format:"yyyy/MM/dd HH:mm",type:"datetimerange",placement:"bottom"},on:{"on-change":function(e){return t.taskTimeChange(t.addData)},"on-open-change":t.taskTimeOpenChange},model:{value:t.addData.times,callback:function(e){t.$set(t.addData,"times",e)},expression:"addData.times"}},[a("div",{staticClass:"advanced-time",on:{click:function(e){return t.taskTimeOpenChange(!t.taskTimeOpen)}}},[a("Icon",{attrs:{type:"ios-clock-outline"}}),a("em",{style:t.addData.p_color?{backgroundColor:t.addData.p_color}:{},attrs:{type:"primary"}},[t._v(t._s(t.taskDays))])],1)]):t._e()],1)],1),t.advanced?a("Form",{staticClass:"task-add-advanced",attrs:{"label-width":"auto"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("FormItem",{attrs:{label:t.$L("\u8BA1\u5212\u65F6\u95F4")}},[a("DatePicker",{attrs:{options:t.timeOptions,editable:!1,placeholder:t.$L("\u9009\u62E9\u8BA1\u5212\u8303\u56F4"),format:"yyyy/MM/dd HH:mm",type:"datetimerange"},on:{"on-change":function(e){return t.taskTimeChange(t.addData)}},model:{value:t.addData.times,callback:function(e){t.$set(t.addData,"times",e)},expression:"addData.times"}})],1),a("FormItem",{attrs:{label:t.$L("\u8D1F\u8D23\u4EBA")}},[a("UserSelect",{attrs:{"multiple-max":10,title:t.$L("\u9009\u62E9\u4EFB\u52A1\u8D1F\u8D23\u4EBA"),"project-id":t.addData.project_id,"avatar-size":24,border:""},model:{value:t.addData.owner,callback:function(e){t.$set(t.addData,"owner",e)},expression:"addData.owner"}})],1),a("FormItem",{attrs:{label:t.$L("\u534F\u52A9\u4EBA\u5458")}},[a("UserSelect",{attrs:{"multiple-max":10,title:t.$L("\u9009\u62E9\u4EFB\u52A1\u534F\u52A9\u4EBA\u5458"),"project-id":t.addData.project_id,"disabled-choice":t.addData.owner,"avatar-size":24,border:""},model:{value:t.addData.assist,callback:function(e){t.$set(t.addData,"assist",e)},expression:"addData.assist"}})],1),a("FormItem",[a("div",{attrs:{slot:"label"},slot:"label"},[a("EDropdown",{ref:"eDropdownRef",attrs:{trigger:"click",placement:"bottom"},on:{command:t.dropVisible}},[a("span",{staticClass:"visibility-text"},[t._v(t._s(t.$L("\u53EF\u89C1\u6027"))+" "),a("i",{staticClass:"taskfont"},[t._v("\uE740")])]),a("EDropdownMenu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("EDropdownItem",{attrs:{command:1}},[a("div",{staticClass:"task-menu-icon"},[t.addData.visibility_appoint==1?a("Icon",{staticClass:"completed",attrs:{type:"md-checkmark-circle"}}):a("Icon",{staticClass:"uncomplete",attrs:{type:"md-radio-button-off"}}),t._v(" "+t._s(t.$L("\u9879\u76EE\u4EBA\u5458"))+" ")],1)]),a("EDropdownItem",{attrs:{command:2}},[a("div",{staticClass:"task-menu-icon"},[t.addData.visibility_appoint==2?a("Icon",{staticClass:"completed",attrs:{type:"md-checkmark-circle"}}):a("Icon",{staticClass:"uncomplete",attrs:{type:"md-radio-button-off"}}),t._v(" "+t._s(t.$L("\u4EFB\u52A1\u4EBA\u5458"))+" ")],1)]),a("EDropdownItem",{attrs:{command:3}},[a("div",{staticClass:"task-menu-icon"},[t.addData.visibility_appoint==3?a("Icon",{staticClass:"completed",attrs:{type:"md-checkmark-circle"}}):a("Icon",{staticClass:"uncomplete",attrs:{type:"md-radio-button-off"}}),t._v(" "+t._s(t.$L("\u6307\u5B9A\u6210\u5458"))+" ")],1)])],1)],1)],1),t.addData.visibility_appoint<3?a("div",{staticClass:"ivu-input task-add-visibility",on:{click:t.showCisibleDropdown}},[t.addData.visibility_appoint==1?a("span",[t._v(t._s(t.$L("\u9879\u76EE\u4EBA\u5458\u53EF\u89C1")))]):t.addData.visibility_appoint==2?a("span",[t._v(t._s(t.$L("\u4EFB\u52A1\u4EBA\u5458\u53EF\u89C1")))]):t._e()]):a("UserSelect",{ref:"visibleUserSelectRef",attrs:{"avatar-size":24,title:t.$L("\u9009\u62E9\u6307\u5B9A\u4EBA\u5458"),"project-id":t.addData.project_id,border:""},on:{"on-show-change":t.visibleUserSelectShowChange},model:{value:t.addData.visibility_appointor,callback:function(e){t.$set(t.addData,"visibility_appointor",e)},expression:"addData.visibility_appointor"}})],1),a("div",{staticClass:"subtasks"},[t.addData.subtasks.length>0?a("div",{staticClass:"sublist"},[a("Row",[a("Col",{attrs:{span:"12"}},[t._v(t._s(t.$L("\u4EFB\u52A1\u63CF\u8FF0")))]),a("Col",{attrs:{span:"8"}},[t._v(t._s(t.$L("\u8BA1\u5212\u65F6\u95F4")))]),a("Col",{attrs:{span:"4"}},[t._v(t._s(t.$L("\u8D1F\u8D23\u4EBA")))])],1),t._l(t.addData.subtasks,function(e,n){return a("Row",{key:n},[a("Col",{attrs:{span:"12"}},[a("Input",{attrs:{maxlength:255,clearable:""},on:{"on-clear":function(i){return t.addData.subtasks.splice(n,1)}},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"item.name"}})],1),a("Col",{attrs:{span:"8",title:t.formatDate(e.times)}},[a("DatePicker",{attrs:{options:t.timeOptions,editable:!1,placeholder:t.$L("\u9009\u62E9\u65F6\u95F4"),format:"yyyy/MM/dd HH:mm",type:"datetimerange"},on:{"on-change":function(i){return t.taskTimeChange(e)}},model:{value:e.times,callback:function(i){t.$set(e,"times",i)},expression:"item.times"}})],1),a("Col",{attrs:{span:"4"}},[a("UserSelect",{attrs:{"multiple-max":1,title:t.$L("\u9009\u62E9\u8D1F\u8D23\u4EBA"),"project-id":t.addData.project_id,"avatar-size":24,border:""},model:{value:e.owner,callback:function(i){t.$set(e,"owner",i)},expression:"item.owner"}})],1)],1)})],2):t._e(),a("Input",{class:["enter-input",t.subName==""?"empty":""],attrs:{type:"text",placeholder:t.$L("+ \u8F93\u5165\u5B50\u4EFB\u52A1\uFF0C\u56DE\u8F66\u6DFB\u52A0\u5B50\u4EFB\u52A1")},on:{"on-enter":t.addSubTask},model:{value:t.subName,callback:function(e){t.subName=e},expression:"subName"}})],1)],1):t._e(),a("div",{staticClass:"ivu-modal-footer"},[a("div",{staticClass:"adaption"},[a("Button",{attrs:{type:"default"},on:{click:t.close}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),a("ButtonGroup",{staticClass:"page-manage-add-task-button-group"},[a("Button",{attrs:{type:"primary",loading:t.loadIng>0},on:{click:t.onAdd}},[t._v(t._s(t.$L("\u6DFB\u52A0\u4EFB\u52A1")))]),a("Dropdown",{attrs:{transfer:""},on:{"on-click":function(e){return t.onAdd(!0)}}},[a("Button",{attrs:{type:"primary"}},[a("Icon",{attrs:{type:"ios-arrow-down"}})],1),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[a("DropdownItem",{attrs:{disabled:t.loadIng>0}},[t._v(t._s(t.$L("\u63D0\u4EA4\u7EE7\u7EED\u6DFB\u52A0")))])],1)],1)],1)],1)]),a("TaskExistTips",{ref:"taskExistTipsRef",on:{onAdd:function(e){return t.onAdd(t.again,!0)}}})],1)},ut=[];const ht={name:"TaskAdd",components:{TEditorTask:U,UserSelect:M,TaskExistTips:B},props:{value:{type:Boolean,default:!1}},data(){return{addData:{cascader:[],name:"",content:"",owner:[],assist:[],project_id:0,column_id:0,times:[],subtasks:[],p_level:0,p_name:"",p_color:"",visibility_appoint:1,visibility_appointor:[]},cascaderShow:!1,cascaderData:[],cascaderValue:"",cascaderLoading:0,cascaderAlready:[],advanced:!1,subName:"",taskTimeOpen:!1,timeOptions:{shortcuts:$A.timeOptionShortcuts()},loadIng:0,isMounted:!1,beforeClose:[],again:!1}},async mounted(){this.initCascaderData(),await this.initProjectData(),this.$nextTick(()=>this.$refs.input.focus()),this.isMounted=!0},beforeDestroy(){this.beforeClose.some(t=>{typeof t=="function"&&t()}),this.beforeClose=[]},computed:{...h(["cacheProjects","projectId","cacheColumns","taskPriority"]),taskDays(){const{times:t}=this.addData;let s=$A.date2string(t,"Y-m-d H:i");if(s[0]&&s[1]){let a=Math.ceil(($A.Date(s[1],!0)-$A.Date(s[0],!0))/86400);if(a>0)return a}return 0}},watch:{"addData.owner"(t){this.addData.assist=this.addData.assist.filter(s=>t.indexOf(s)===-1),this.addData.assist.length===0&&t.indexOf(this.userId)===-1&&(this.addData.assist=[this.userId])},"addData.project_id"(t){t>0&&$A.IDBSave("cacheAddTaskProjectId",t)},"addData.column_id"(t){t>0&&$A.IDBSave("cacheAddTaskColumnId",t);const{project_id:s}=this.addData;s&&t?this.$set(this.addData,"cascader",[s,t]):this.$set(this.addData,"cascader",[])}},methods:{initCascaderData(){const t=$A.cloneJSON(this.cacheProjects).sort((s,a)=>s.top_at||a.top_at?$A.Date(a.top_at)-$A.Date(s.top_at):a.id-s.id);this.cascaderData=t.map(s=>{const a=this.cacheColumns.filter(({project_id:n})=>n==s.id).map(n=>({value:n.id,label:n.name})),e={value:s.id,label:s.name,children:a};return a.length==0&&(e.loading=!1),e})},async initProjectData(){let t=await $A.IDBInt("cacheAddTaskProjectId"),s=this.cacheProjects.find(({id:a})=>a==this.projectId)||this.cacheProjects.find(({id:a})=>a==t)||this.cacheProjects.find(({id:a})=>a>0);if(s){let a=await $A.IDBInt("cacheAddTaskColumnId"),e=this.cacheColumns.find(({project_id:n,id:i})=>n==s.id&&i==a)||this.cacheColumns.find(({project_id:n})=>n==s.id);e?(this.addData.project_id=e.project_id,this.addData.column_id=e.id):this.$store.dispatch("getColumns",s.id).then(()=>{e=this.cacheColumns.find(({project_id:n,id:i})=>n==s.id&&i==a)||this.cacheColumns.find(({project_id:n})=>n==s.id),e&&(this.addData.project_id=e.project_id,this.addData.column_id=e.id)}).catch(()=>{})}this.taskPriority.length>0&&await this.choosePriority(this.taskPriority[0])},async taskTimeChange(t){const s=$A.date2string(t.times,"Y-m-d H:i");$A.rightExists(s[0],"00:00")&&$A.rightExists(s[1],"00:00")&&this.$set(t,"times",await this.$store.dispatch("taskDefaultTime",s))},taskTimeOpenChange(t){this.taskTimeOpen=t},formatDate(t){return t?$A.date2string(t):null},onKeydown(t){if(t.keyCode===13){if(t.shiftKey)return;t.preventDefault(),this.onAdd()}},addSubTask(){this.subName.trim()!==""&&(this.addData.subtasks.push({name:this.subName.trim(),owner:[this.userId],times:[]}),this.subName="")},taskPriorityContent(t){const s=$A.runNum(t.days);return s<=0?t.name+" ("+this.$L("\u65E0\u65F6\u95F4\u9650\u5236")+")":t.name+" ("+s+this.$L("\u5929")+")"},async choosePriority(t){const s=new Date,a=$A.runNum(t.days);if(a>0){const e=new Date(new Date().setDate(s.getDate()+a));this.$set(this.addData,"times",await this.$store.dispatch("taskDefaultTime",$A.date2string([s,e])))}else this.$set(this.addData,"times",[]);this.$set(this.addData,"p_level",t.priority),this.$set(this.addData,"p_name",t.name),this.$set(this.addData,"p_color",t.color)},cascaderLoadData(t,s){t.loading=!0,this.$store.dispatch("getColumns",t.value).then(a=>{t.children=a.map(e=>({value:e.id,label:e.name})),t.loading=!1,s()}).catch(()=>{t.loading=!1,s()})},cascaderChange(t){t[1]&&(this.$set(this.addData,"project_id",t[0]),this.$set(this.addData,"column_id",t[1]))},cascaderInputChange(t){this.cascaderValue=t||"",this.cascaderAlready[this.cascaderValue]!==!0&&(this.cascaderAlready[this.cascaderValue]=!0,setTimeout(()=>{this.cascaderLoading++},1e3),this.$store.dispatch("getProjects",{keys:{name:this.cascaderValue},getcolumn:"yes"}).then(()=>{this.cascaderLoading--,this.initCascaderData()}).catch(()=>{this.cascaderLoading--}))},setData(t){if(!this.isMounted){this.__setData&&clearTimeout(this.__setData),this.__setData=setTimeout(s=>this.setData(t),10);return}typeof t.beforeClose!="undefined"&&(this.beforeClose.push(t.beforeClose),delete t.beforeClose),this.addData=Object.assign({},this.addData,t)},async onAdd(t,s=!1){if(!this.addData.name){$A.messageError("\u4EFB\u52A1\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A");return}if(this.loadIng++,!s&&this.addData.owner.length>0){this.$refs.taskExistTipsRef.isExistTask({userids:this.addData.owner,timerange:this.addData.times}).then(a=>{a?(this.loadIng--,this.again=t):this.onAdd(t,!0)});return}this.$store.dispatch("taskAdd",this.addData).then(({msg:a})=>{this.loadIng--,$A.messageSuccess(a),t===!0?(this.addData=Object.assign({},this.addData,{name:"",content:"",subtasks:[]}),this.$refs.input.focus()):(this.addData={cascader:[],name:"",content:"",owner:[],assist:[],column_id:0,times:[],subtasks:[],p_level:0,p_name:"",p_color:""},this.close())}).catch(({msg:a})=>{this.loadIng--,$A.modalError(a)})},close(){this.$emit("input",!this.value)},showCisibleDropdown(){this.$refs.eDropdownRef.show()},visibleUserSelectShowChange(t){if(!t&&(this.addData.visibility_appointor.length==0||!this.addData.visibility_appointor[0])){let s=this.addData.old_visibility_appoint;this.addData.visibility_appoint=s>2?1:s||1,this.addData.visibility_appoint<3}},dropVisible(t){switch(t){case 1:case 2:this.addData.visibility_appoint=t;break;case 3:this.addData.old_visibility_appoint=this.addData.visibility_appoint,this.addData.visibility_appoint=t,this.$nextTick(()=>{this.$refs.visibleUserSelectRef.onSelection()});break}}}},D={};var pt=d(ht,dt,ut,!1,mt,null,null,null);function mt(t){for(let s in D)this[s]=D[s]}var ft=function(){return pt.exports}(),gt=function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"mobile-back"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.windowScrollY>0,expression:"windowScrollY > 0"}],ref:"bar",staticClass:"back-bar"}),t.show?a("div",{staticClass:"back-semicircle",style:t.style}):t._e()])},vt=[];const _t={name:"MobileBack",props:{showTabbar:{type:Boolean,default:!1}},data(){return{show:!1,x:0,y:0}},created(){this.appAndroidEvents()},mounted(){this.$refs.bar.addEventListener("touchmove",this.barListener),document.addEventListener("touchstart",this.touchstart),document.addEventListener("touchmove",this.touchmove),document.addEventListener("touchend",this.touchend)},beforeDestroy(){this.$refs.bar.removeEventListener("touchmove",this.barListener),document.removeEventListener("touchstart",this.touchstart),document.removeEventListener("touchmove",this.touchmove),document.removeEventListener("touchend",this.touchend)},computed:{...h(["fileLists","messengerSearchKey"]),style(){const s=Math.max(135,this.y)+this.windowScrollY,a=this.windowHeight-135;return{top:Math.min(s,a)+"px",left:this.x>20?0:"-50px"}},routeName(){return this.$route.name},fileFolderId(){const{folderId:t}=this.$route.params;return parseInt(/^\d+$/.test(t)?t:0)}},watch:{show(t){t?document.body.classList.add("touch-back"):document.body.classList.remove("touch-back"),this.$store.state.touchBackInProgress=t}},methods:{getXY(t){let s=t.touches[0];this.x=s.clientX,this.y=s.clientY},barListener(t){t.preventDefault()},touchstart(t){this.getXY(t),this.show=this.canBack()&&this.x<20},touchmove(t){this.show&&this.getXY(t)},touchend(){this.x>90&&this.show&&this.onBack(),this.x=0,this.show=!1},canBack(){if(!this.showTabbar||this.$Modal.visibles().length>0||this.fileFolderId>0)return!0;if(this.routeName==="manage-messenger"){if(this.$route.params.dialogAction==="contacts"){if(this.messengerSearchKey.contacts)return!0}else if(this.messengerSearchKey.dialog)return!0}let t=!1;return k.setGlobalData({type:"modalVisible",callback:(s,a)=>{a&&(t=!0)}}),!!t},onBack(){let t=!1;if(k.setGlobalData({type:"route",action:"back",route:this.$route,callback:(s,a)=>{a&&(t=!0)}}),!t&&!this.$Modal.removeLast()){if(this.routeName==="manage-file"&&this.fileFolderId==0){this.goForward({name:"manage-application"});return}if(this.routeName==="manage-messenger"){if(this.$route.params.dialogAction==="contacts"){if(this.messengerSearchKey.contacts){this.$store.state.messengerSearchKey.contacts="";return}}else if(this.messengerSearchKey.dialog){this.$store.state.messengerSearchKey.dialog="";return}}this.goBack()}},appAndroidEvents(){this.$isEEUiApp&&$A.isAndroid()&&$A.eeuiAppSetPageBackPressed({pageName:"firstPage"},t=>{this.canBack()?this.onBack():$A.eeuiAppGoDesktop()})}}},C={};var bt=d(_t,gt,vt,!1,kt,null,null,null);function kt(t){for(let s in C)this[s]=C[s]}var $t=function(){return bt.exports}(),wt=function(){var t=this,s=t.$createElement,a=t._self._c||s;return t.show&&t.userid>0?a("transition",{attrs:{name:"mobile-notify"}},[a("div",{staticClass:"mobile-notification",class:{show:t.show},on:{click:function(e){return e.stopPropagation(),t.onClick.apply(null,arguments)},touchstart:t.onTouchstart,touchmove:t.onTouchmove}},[a("UserAvatar",{attrs:{userid:t.userid,size:40,"show-name":"","name-text":t.title}}),a("div",{staticClass:"notification-desc no-dark-content"},[t._v(t._s(t.desc))])],1)]):t._e()},yt=[];const Dt={name:"MobileNotification",data(){return{userid:0,title:"",desc:"",duration:6e3,callback:null,show:!1,timer:null,startY:0}},beforeDestroy(){this.timer&&clearTimeout(this.timer),this.show=!1},methods:{open(t){!$A.isJson(t)||(this.userid=t.userid||0,this.title=t.title||"",this.desc=t.desc||"",this.duration=typeof t.duration=="number"?t.duration:6e3,this.callback=typeof t.callback=="function"?t.callback:null,this.show=!0,this.timer&&clearTimeout(this.timer),this.duration>0&&(this.timer=setTimeout(this.close,this.duration)),$A.eeuiAppSendMessage({action:"setVibrate"}))},close(){this.show=!1},onClick(){this.close(),typeof this.callback=="function"&&this.callback()},onTouchstart(t){this.startY=t.touches[0].clientY},onTouchmove(t){this.startY>0&&this.startY-t.touches[0].clientY>10&&(this.startY=0,this.close())}}},x={};var Ct=d(Dt,wt,yt,!1,xt,null,null,null);function xt(t){for(let s in x)this[s]=x[s]}var Lt=function(){return Ct.exports}(),Tt=function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("Modal",{attrs:{value:t.visible,mask:!1,"mask-closable":!1,"footer-hide":!0,"transition-names":["mobile-dialog",""],beforeClose:t.onBeforeClose,"class-name":"dialog-modal",fullscreen:""}},[t.windowPortrait&&t.dialogId>0?a("DialogWrapper",{attrs:{dialogId:t.dialogId,beforeBack:t.onBeforeClose}}):t._e()],1)},At=[];const St={name:"DialogModal",components:{DialogWrapper:V},data(){return{timer:null}},computed:{...h(["dialogId"]),visible(){return this.dialogId>0&&this.windowPortrait}},methods:{onBeforeClose(){return new Promise(t=>{this.$store.dispatch("openDialog",0)})}}},L={};var Mt=d(St,Tt,At,!1,It,null,null,null);function It(t){for(let s in L)this[s]=L[s]}var jt=function(){return Mt.exports}(),Nt=function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("Modal",{attrs:{value:t.show,styles:t.styles,"mask-closable":!1,"footer-hide":!0,beforeClose:t.onBeforeClose,"class-name":"task-modal"}},[a("TaskDetail",{ref:"taskDetail",attrs:{"task-id":t.taskId,"open-task":t.taskData,modalMode:""}})],1)},Pt=[];const Rt={name:"TaskModal",components:{TaskDetail:O},computed:{...h(["taskId"]),...v(["taskData"]),show(){return this.taskId>0},styles(){return{width:"90%",maxWidth:this.taskData.dialog_id?"1200px":"700px"}}},methods:{onBeforeClose(){return new Promise(t=>{this.$store.dispatch("openTask",0)})},checkUpdate(){if(this.show)return this.$refs.taskDetail.checkUpdate(!0),!0}}},T={};var Et=d(Rt,Nt,Pt,!1,Ut,null,null,null);function Ut(t){for(let s in T)this[s]=T[s]}var Bt=function(){return Et.exports}(),Ot=function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("Modal",{attrs:{title:t.$L("\u5BFC\u51FA\u4EFB\u52A1\u7EDF\u8BA1"),"mask-closable":!1},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[a("Form",{ref:"exportTask",attrs:{model:t.formData,"label-width":"auto"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("FormItem",{attrs:{label:t.$L("\u5BFC\u51FA\u6210\u5458")}},[a("UserSelect",{attrs:{"multiple-max":100,"avatar-name":"","show-disable":"",title:t.$L("\u8BF7\u9009\u62E9\u6210\u5458")},model:{value:t.formData.userid,callback:function(e){t.$set(t.formData,"userid",e)},expression:"formData.userid"}}),a("div",{staticClass:"form-tip"},[t._v(t._s(t.$L("\u6BCF\u6B21\u6700\u591A\u9009\u62E9\u5BFC\u51FA100\u4E2A\u6210\u5458")))])],1),a("FormItem",{attrs:{label:t.$L("\u65F6\u95F4\u8303\u56F4")}},[a("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"daterange",format:"yyyy/MM/dd",placeholder:t.$L("\u8BF7\u9009\u62E9\u65F6\u95F4")},model:{value:t.formData.time,callback:function(e){t.$set(t.formData,"time",e)},expression:"formData.time"}}),a("div",{staticClass:"form-tip checkin-export-quick-select"},[a("span",[t._v(t._s(t.$L("\u5FEB\u6377\u9009\u62E9"))+":")]),a("em",{on:{click:function(e){t.formData.time=t.dateShortcuts("prev")}}},[t._v(t._s(t.$L("\u4E0A\u4E2A\u6708")))]),a("em",{on:{click:function(e){t.formData.time=t.dateShortcuts("this")}}},[t._v(t._s(t.$L("\u8FD9\u4E2A\u6708")))])])],1),a("FormItem",{attrs:{prop:"type",label:t.$L("\u5BFC\u51FA\u65F6\u95F4\u7C7B\u578B")}},[a("RadioGroup",{model:{value:t.formData.type,callback:function(e){t.$set(t.formData,"type",e)},expression:"formData.type"}},[a("Radio",{attrs:{label:"taskTime"}},[t._v(t._s(t.$L("\u4EFB\u52A1\u65F6\u95F4")))]),a("Radio",{attrs:{label:"createdTime"}},[t._v(t._s(t.$L("\u521B\u5EFA\u65F6\u95F4")))])],1)],1)],1),a("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default"},on:{click:function(e){t.show=!1}}},[t._v(t._s(t.$L("\u53D6\u6D88")))]),a("Button",{attrs:{type:"primary",loading:t.loadIng>0},on:{click:t.onExport}},[t._v(t._s(t.$L("\u5BFC\u51FA")))])],1)],1)},Ft=[];const zt={name:"TaskExport",components:{UserSelect:M},props:{value:{type:Boolean,default:!1}},data(){return{show:this.value,loadIng:0,formData:{userid:[],time:[],type:"taskTime"}}},watch:{value(t){this.show=t},show(t){this.value!==t&&this.$emit("input",t)}},methods:{dateShortcuts(t){if(t==="prev")return[$A.getSpecifyDate("\u4E0A\u4E2A\u6708"),$A.getSpecifyDate("\u4E0A\u4E2A\u6708\u7ED3\u675F")];if(t==="this")return[$A.getSpecifyDate("\u672C\u6708"),$A.getSpecifyDate("\u672C\u6708\u7ED3\u675F")]},onExport(){this.loadIng>0||(this.loadIng++,this.$store.dispatch("call",{url:"project/task/export",data:this.formData}).then(({data:t})=>{this.show=!1,$A.messageSuccess(t.msg)}).catch(({msg:t})=>{$A.modalError(t)}).finally(t=>{this.loadIng--}))}}},A={};var Vt=d(zt,Ot,Ft,!1,Ht,null,null,null);function Ht(t){for(let s in A)this[s]=A[s]}var Wt=function(){return Vt.exports}();const Kt=(t,s)=>!t||!s?!1:t==="String"?typeof s=="string":t==="Object"?Object.prototype.toString.call(s)==="[object Object]":t==="number"?typeof s=="number":t==="function"?Object.prototype.toString.call(s)==="[object Function]":!1,Yt=(t,s,a)=>t.findIndex(e=>e[s]===a);var c={checkData:Kt,searchArrObj:Yt};class qt{constructor(s="\u9ED8\u8BA4\u6807\u9898",a={}){this.title=s,this.options=a,this.support=!1,this.supportFn()}supportFn(){window.Notification?(this.initStatus(),this.support=!0):this.support=!1}initStatus(){this.notification=null,this.state=Notification.permission,this.msg=null,this.callBackObj={},this.notificationAll=[],this.requireInteractionTimeout=!1,this.timeout=null}initNotification(s){if(!!this.checkStatus("support")){if(!c.checkData("function",s))return console.error("initNotification\u7684\u53C2\u6570\u5FC5\u987B\u4E3A\u51FD\u6570");if(this.state==="granted")this.msg="already granted";else if(this.state==="default"){const a=e=>(this.state=e,e==="granted"?this.msg="granted":e==="default"?this.msg="close":this.msg="denied",s(this.msg));try{Notification.requestPermission().then(a)}catch{Notification.requestPermission(a)}}else this.msg="already denied";if(this.state!=="default")return s(this.msg)}}userAgreed(){if(!!this.checkStatus("userAgreed")){this.notification=new Notification(this.title,this.options),this.notificationWatch();for(const s in this.callBackObj)this.notification[s]=a=>{this.callBackObj[s](a)}}}notificationTimeoutFn(s){s&&c.checkData("number",s)?this.timeout=s:this.timeout=5e3}notificationWatch(){this.notificationAll.push(this.notification),this.notification.requireInteraction?this.everyTimeout():this.autoClose(),this.watchClose()}everyTimeout(){!c.checkData("number",this.timeout)||(this.options.timeOut&&c.checkData("number",this.options.timeOut)?this.timeoutCloseFn(this.options.timeOut):this.timeoutCloseFn(this.timeout))}timeoutCloseFn(s){const a=this.notification.timestamp;setTimeout(()=>{const e=c.searchArrObj(this.notificationAll,"timestamp",a);e!==-1&&this.notificationAll[e].close()},s)}watchClose(){const s=this.notification.timestamp;this.notification.addEventListener("close",a=>{const e=c.searchArrObj(this.notificationAll,"timestamp",s);e!==-1&&this.notificationAll.splice(e,1)})}autoClose(){const s=this.notification.timestamp;setTimeout(()=>{const a=c.searchArrObj(this.notificationAll,"timestamp",s);a!==-1&&this.notificationAll.splice(a,1)},6e3)}notificationEvent(s){if(!!this.checkStatus("support"))if(c.checkData("Object",s)){for(const a in s)if(!c.checkData("function",s[a]))return console.error("callObj\u5BF9\u8C61\u4E2D\u7684\u6BCF\u4E2Avalue\u5FC5\u987B\u4E3A\u51FD\u6570");this.callBackObj=s}else return console.error("callObj\u5FC5\u987B\u4E3A\u5BF9\u8C61")}closeAll(){for(let s of this.notificationAll.values())s.close();this.notificationAll=[]}close(){if(!this.notification)return console.warn("this.notification\u4E3Anull,\u901A\u77E5\u5C1A\u672A\u8C03\u7528/\u7528\u6237\u672A\u540C\u610F\u663E\u793A\u901A\u77E5");this.notification.close()}updateOptions(s){if(s&&c.checkData("Object",s))for(const a in s)this.options[a]=s[a];else console.warn("updateOptions\u53C2\u6570\u9519\u8BEF\uFF1Aoptions\u4E3A\u5FC5\u586B\u5BF9\u8C61")}replaceTitle(s){s&&c.checkData("String",s)?this.title=s:console.warn("replaceTitle: title(\u901A\u77E5\u6807\u9898)\u4E3A\u5FC5\u586B\u5B57\u7B26\u4E32")}replaceOptions(s){s&&c.checkData("Object",s)?this.options=s:console.warn("replaceOptions\u53C2\u6570\u9519\u8BEF\uFF1Aoptions\u4E3A\u5FC5\u586B\u5BF9\u8C61")}checkStatus(s){if(s==="support"){if(!this.support)return console.warn("\u7528\u6237\u6D4F\u89C8\u5668\u4E0D\u652F\u6301"),!1}else if(s==="userAgreed"&&(this.state!=="granted"||!this.checkStatus("support")))return!1;return!0}}var Gt=function(){var t,s,a,e=this,n=e.$createElement,i=e._self._c||n;return i("div",{staticClass:"page-manage",class:{"show-tabbar":e.showMobileTabbar,"not-logged":e.userId<=0}},[i("div",{staticClass:"manage-box-menu",class:{"show-mobile-menu":e.showMobileMenu}},[i("Dropdown",{staticClass:"page-manage-menu-dropdown main-menu",attrs:{trigger:"click"},on:{"on-click":e.settingRoute,"on-visible-change":e.menuVisibleChange}},[i("div",{class:["manage-box-title",e.visibleMenu?"menu-visible":""]},[i("div",{staticClass:"manage-box-avatar"},[i("UserAvatar",{attrs:{userid:e.userId,size:42,tooltipDisabled:""}})],1),e.clientNewVersion?i("Badge",{staticClass:"manage-box-top-report",attrs:{dot:""}}):e._e()],1),i("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[e._l(e.menu,function(o){return[o.path==="taskBrowse"?i("Dropdown",{attrs:{transfer:"","transfer-class-name":"page-manage-menu-dropdown",placement:"right-start"}},[i("DropdownItem",{attrs:{divided:!!o.divided}},[i("div",{staticClass:"manage-menu-flex"},[e._v(" "+e._s(e.$L(o.name))+" "),i("Icon",{attrs:{type:"ios-arrow-forward"}})],1)]),e.taskBrowseLists.length>0?i("DropdownMenu",{attrs:{slot:"list"},slot:"list"},e._l(e.taskBrowseLists,function(r,p){return r.id>0&&p<10?i("DropdownItem",{key:p,staticClass:"task-title",attrs:{name:r.name},nativeOn:{click:function(m){return e.openTask(r)}}},[r.flow_item_name?i("span",{class:r.flow_item_status},[e._v(e._s(r.flow_item_name))]):e._e(),i("div",{staticClass:"task-title-text"},[e._v(e._s(r.name))])]):e._e()}),1):i("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[i("DropdownItem",{staticStyle:{color:"darkgrey"}},[e._v(e._s(e.$L("\u6682\u65E0\u6253\u5F00\u8BB0\u5F55")))])],1)],1):o.path==="team"?i("Dropdown",{staticClass:"display-block",attrs:{transfer:"","transfer-class-name":"page-manage-menu-dropdown",placement:"right-start"}},[i("DropdownItem",{attrs:{divided:!!o.divided}},[i("div",{staticClass:"manage-menu-flex"},[e._v(" "+e._s(e.$L(o.name))+" "),i("Icon",{attrs:{type:"ios-arrow-forward"}})],1)]),i("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[i("DropdownItem",{attrs:{name:"allUser"}},[e._v(e._s(e.$L("\u56E2\u961F\u7BA1\u7406")))]),i("DropdownItem",{attrs:{name:"exportTask"}},[e._v(e._s(e.$L("\u5BFC\u51FA\u4EFB\u52A1\u7EDF\u8BA1")))]),i("DropdownItem",{attrs:{name:"exportOverdueTask"}},[e._v(e._s(e.$L("\u5BFC\u51FA\u8D85\u671F\u4EFB\u52A1")))]),i("DropdownItem",{attrs:{name:"exportApprove"}},[e._v(e._s(e.$L("\u5BFC\u51FA\u5BA1\u6279\u6570\u636E")))]),i("DropdownItem",{attrs:{name:"exportCheckin"}},[e._v(e._s(e.$L("\u5BFC\u51FA\u7B7E\u5230\u6570\u636E")))])],1)],1):o.visible!==!1?i("DropdownItem",{style:o.style||{},attrs:{divided:!!o.divided,name:o.path}},[i("div",{staticClass:"manage-menu-flex"},[e._v(" "+e._s(e.$L(o.name))+" "),o.path==="version"?i("Badge",{staticClass:"manage-menu-report-badge",attrs:{text:e.clientNewVersion}}):o.path==="workReport"&&e.reportUnreadNumber>0?i("Badge",{staticClass:"manage-menu-report-badge",attrs:{count:e.reportUnreadNumber}}):o.path==="approve"&&e.approveUnreadNumber>0?i("Badge",{staticClass:"manage-menu-report-badge",attrs:{count:e.approveUnreadNumber}}):e._e()],1)]):e._e()]})],2)],1),i("Scrollbar",{attrs:{"class-name":"manage-item"},on:{"on-scroll":function(o){e.operateVisible=!1}}},[i("div",{staticClass:"menu-base"},[i("ul",[i("li",{class:e.classNameRoute("dashboard"),on:{click:function(o){return e.toggleRoute("dashboard")}}},[(t=e.classNameRoute("dashboard"))!==null&&t!==void 0&&t.active?i("i",{staticClass:"taskfont"},[e._v("\uE7F7")]):i("i",{staticClass:"taskfont"},[e._v("\uE7F8")]),i("div",{staticClass:"menu-title"},[e._v(e._s(e.$L("\u9996\u9875")))]),e.dashboardTask.overdue_count>0?i("Badge",{staticClass:"menu-badge",attrs:{type:"error","overflow-count":999,count:e.dashboardTask.overdue_count}}):e.dashboardTask.today_count>0?i("Badge",{staticClass:"menu-badge",attrs:{type:"info","overflow-count":999,count:e.dashboardTask.today_count}}):e.dashboardTask.all_count>0?i("Badge",{staticClass:"menu-badge",attrs:{type:"primary","overflow-count":999,count:e.dashboardTask.all_count}}):e._e()],1),i("li",{class:e.classNameRoute("messenger"),on:{click:function(o){return e.toggleRoute("messenger")}}},[(s=e.classNameRoute("messenger"))!==null&&s!==void 0&&s.active?i("i",{staticClass:"taskfont"},[e._v("\uE7F5")]):i("i",{staticClass:"taskfont"},[e._v("\uE6EB")]),i("div",{staticClass:"menu-title"},[e._v(e._s(e.$L("\u6D88\u606F")))]),i("Badge",{staticClass:"menu-badge",attrs:{"overflow-count":999,text:e.msgUnreadMention}})],1),i("li",{class:e.classNameRoute("project"),on:{click:function(o){return e.toggleRoute("project")}}},[(a=e.classNameRoute("project"))!==null&&a!==void 0&&a.active?i("i",{staticClass:"taskfont"},[e._v("\uE6F9")]):i("i",{staticClass:"taskfont"},[e._v("\uE6FA")]),i("div",{staticClass:"menu-title"},[e._v(e._s(e.$L("\u9879\u76EE")))])]),i("li",{class:e.classNameRoute("file"),on:{click:function(o){return e.toggleRoute("file")}}},[i("i",{staticClass:"taskfont"},[e._v("\uE6F3")]),i("div",{staticClass:"menu-title"},[e._v(e._s(e.$L("\u6587\u4EF6")))])]),i("li",{class:e.classNameRoute("application"),on:{click:function(o){return e.toggleRoute("application")}}},[i("i",{staticClass:"taskfont"},[e._v("\uE60C")]),i("div",{staticClass:"menu-title"},[e._v(e._s(e.$L("\u5E94\u7528")))]),i("Badge",{staticClass:"menu-badge",attrs:{"overflow-count":999,text:String(e.reportUnreadNumber+e.approveUnreadNumber||"")}})],1)])])]),i("div",{staticClass:"manage-box-new-group"},[i("ul",[!!e.clientNewVersion||!e.$Electron?i("li",{staticClass:"client-download-update"},[e.clientDownloadUrl&&!e.$Electron?i("Tooltip",{attrs:{content:e.$L("\u5BA2\u6237\u7AEF\u4E0B\u8F7D"),placement:"right",transfer:"",delay:300}},[i("a",{staticClass:"client-download common-right-bottom-link",attrs:{href:e.clientDownloadUrl,target:"_blank"}},[i("i",{staticClass:"taskfont"},[e._v("\uE7FA")])])]):!!e.clientNewVersion&&e.$Electron?i("Tooltip",{attrs:{content:e.$L("\u66F4\u65B0\u5BA2\u6237\u7AEF"),placement:"right",transfer:"",delay:300}},[i("i",{staticClass:"taskfont",on:{click:function(o){return e.settingRoute("version")}}},[e._v("\uE7FB")])]):e._e()],1):e._e(),i("li",{on:{click:e.onAddShow}},[i("Tooltip",{attrs:{content:e.$L("\u65B0\u5EFA\u9879\u76EE")+" ("+e.mateName+"+B)",placement:"right",transfer:"",delay:300}},[i("i",{staticClass:"taskfont"},[e._v("\uE7B9")])])],1),i("li",{on:{click:function(o){return e.onAddMenu("task")}}},[i("Tooltip",{attrs:{content:e.$L("\u65B0\u5EFA\u4EFB\u52A1")+" ("+e.mateName+"+K)",placement:"right",transfer:"",delay:300}},[i("i",{staticClass:"taskfont"},[e._v("\uE7B5")])])],1),i("li",{on:{click:function(o){return e.onAddMenu("createMeeting")}}},[i("Tooltip",{attrs:{content:e.$L("\u65B0\u4F1A\u8BAE")+" ("+e.mateName+"+J)",placement:"right",transfer:"",delay:300}},[i("i",{staticClass:"taskfont"},[e._v("\uE7C1")])])],1),i("li",{on:{click:function(o){return e.onAddMenu("joinMeeting")}}},[i("Tooltip",{attrs:{content:e.$L("\u52A0\u5165\u4F1A\u8BAE"),placement:"right",transfer:"",delay:300}},[i("i",{staticClass:"taskfont"},[e._v("\uE794")])])],1)])])],1),i("div",{staticClass:"manage-box-main"},[i("keep-alive",[i("router-view",{staticClass:"manage-box-view",on:{"on-click":e.onTabbarClick}})],1)],1),i("Modal",{attrs:{title:e.$L("\u65B0\u5EFA\u9879\u76EE"),"mask-closable":!1},model:{value:e.addShow,callback:function(o){e.addShow=o},expression:"addShow"}},[i("Form",{ref:"addProject",attrs:{model:e.addData,rules:e.addRule,"label-width":"auto"},nativeOn:{submit:function(o){o.preventDefault()}}},[i("FormItem",{attrs:{prop:"name",label:e.$L("\u9879\u76EE\u540D\u79F0")}},[i("Input",{ref:"projectName",attrs:{type:"text"},model:{value:e.addData.name,callback:function(o){e.$set(e.addData,"name",o)},expression:"addData.name"}})],1),e.addData.columns?i("FormItem",{attrs:{label:e.$L("\u4EFB\u52A1\u5217\u8868")}},[i("TagInput",{model:{value:e.addData.columns,callback:function(o){e.$set(e.addData,"columns",o)},expression:"addData.columns"}})],1):i("FormItem",{attrs:{label:e.$L("\u9879\u76EE\u6A21\u677F")}},[i("Select",{attrs:{value:0,placeholder:e.$L("\u8BF7\u9009\u62E9\u6A21\u677F")},on:{"on-change":e.selectChange}},e._l(e.columns,function(o,r){return i("Option",{key:r,attrs:{value:r}},[e._v(e._s(o.name))])}),1)],1),i("FormItem",{attrs:{prop:"flow",label:e.$L("\u5F00\u542F\u5DE5\u4F5C\u6D41")}},[i("RadioGroup",{model:{value:e.addData.flow,callback:function(o){e.$set(e.addData,"flow",o)},expression:"addData.flow"}},[i("Radio",{attrs:{label:"open"}},[e._v(e._s(e.$L("\u5F00\u542F")))]),i("Radio",{attrs:{label:"close"}},[e._v(e._s(e.$L("\u5173\u95ED")))])],1)],1)],1),i("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"default"},on:{click:function(o){e.addShow=!1}}},[e._v(e._s(e.$L("\u53D6\u6D88")))]),i("Button",{attrs:{type:"primary",loading:e.loadIng>0},on:{click:e.onAddProject}},[e._v(e._s(e.$L("\u6DFB\u52A0")))])],1)],1),i("Modal",{attrs:{"mask-closable":!1,styles:{width:"90%",maxWidth:"640px"},"footer-hide":""},model:{value:e.addTaskShow,callback:function(o){e.addTaskShow=o},expression:"addTaskShow"}},[i("TaskAdd",{ref:"addTask",model:{value:e.addTaskShow,callback:function(o){e.addTaskShow=o},expression:"addTaskShow"}})],1),i("TaskExport",{model:{value:e.exportTaskShow,callback:function(o){e.exportTaskShow=o},expression:"exportTaskShow"}}),i("CheckinExport",{model:{value:e.exportCheckinShow,callback:function(o){e.exportCheckinShow=o},expression:"exportCheckinShow"}}),i("ApproveExport",{model:{value:e.exportApproveShow,callback:function(o){e.exportApproveShow=o},expression:"exportApproveShow"}}),i("TaskModal",{ref:"taskModal"}),i("DialogModal",{ref:"dialogModal"}),i("DrawerOverlay",{attrs:{placement:"right",size:1200},model:{value:e.workReportShow,callback:function(o){e.workReportShow=o},expression:"workReportShow"}},[e.workReportShow?i("Report",{on:{"on-read":function(o){return e.$store.dispatch("getReportUnread",1e3)}},model:{value:e.reportTabs,callback:function(o){e.reportTabs=o},expression:"reportTabs"}}):e._e()],1),i("DrawerOverlay",{attrs:{placement:"right",size:1380},model:{value:e.allUserShow,callback:function(o){e.allUserShow=o},expression:"allUserShow"}},[e.allUserShow?i("TeamManagement"):e._e()],1),i("DrawerOverlay",{attrs:{placement:"right",size:1200},model:{value:e.allProjectShow,callback:function(o){e.allProjectShow=o},expression:"allProjectShow"}},[e.allProjectShow?i("ProjectManagement"):e._e()],1),i("DrawerOverlay",{attrs:{placement:"right",size:1200},model:{value:e.archivedProjectShow,callback:function(o){e.archivedProjectShow=o},expression:"archivedProjectShow"}},[e.archivedProjectShow?i("ProjectArchived"):e._e()],1),i("MeetingManager"),i("transition",{attrs:{name:"mobile-slide"}},[e.showMobileTabbar?i("MobileTabbar",{on:{"on-click":e.onTabbarClick}}):e._e()],1),i("MobileBack",{attrs:{showTabbar:e.showMobileTabbar}}),i("MobileNotification",{ref:"mobileNotification"}),e.$route.name!="manage-apps"?i("MicroApps",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{name:"okr-details",url:e.okrUrl,datas:e.okrWindow}}):e._e()],1)},Jt=[];const Xt={components:{TaskExport:Wt,CheckinExport:N,ApproveExport:H,TaskModal:Bt,DialogModal:jt,MeetingManager:F,MobileNotification:Lt,MobileBack:$t,MobileTabbar:ct,TaskAdd:ft,Report:P,DrawerOverlay:E,ProjectManagement:st,TeamManagement:R,ProjectArchived:X,MicroApps:W},directives:{longpress:z},data(){return{loadIng:0,mateName:/macintosh|mac os x/i.test(navigator.userAgent)?"\u2318":"Ctrl",addShow:!1,addData:{name:"",columns:"",flow:"open"},addRule:{name:[{required:!0,message:this.$L("\u8BF7\u586B\u5199\u9879\u76EE\u540D\u79F0\uFF01"),trigger:"change"},{type:"string",min:2,message:this.$L("\u9879\u76EE\u540D\u79F0\u81F3\u5C112\u4E2A\u5B57\uFF01"),trigger:"change"}]},addTaskShow:!1,addTaskSubscribe:null,exportTaskShow:!1,exportCheckinShow:!1,exportApproveShow:!1,dialogMsgSubscribe:null,visibleMenu:!1,showMobileMenu:!1,workReportShow:!1,allUserShow:!1,allProjectShow:!1,archivedProjectShow:!1,natificationReady:!1,notificationManage:null,reportTabs:"my",needStartHome:!1}},mounted(){this.notificationInit(),this.addTaskSubscribe=u.Store.subscribe("addTask",this.onAddTask),this.dialogMsgSubscribe=u.Store.subscribe("dialogMsgPush",this.addDialogMsg),document.addEventListener("keydown",this.shortcutEvent)},activated(){this.$store.dispatch("getUserInfo").catch(t=>{}),this.$store.dispatch("getTaskPriority").catch(t=>{}),this.$store.dispatch("getReportUnread",0),this.$store.dispatch("getApproveUnread",0),this.$store.dispatch("needHome").then(t=>{this.needStartHome=!0}).catch(t=>{this.needStartHome=!1})},beforeDestroy(){this.addTaskSubscribe&&(this.addTaskSubscribe.unsubscribe(),this.addTaskSubscribe=null),this.dialogMsgSubscribe&&(this.dialogMsgSubscribe.unsubscribe(),this.dialogMsgSubscribe=null),document.removeEventListener("keydown",this.shortcutEvent)},deactivated(){this.addShow=!1},computed:{...h(["userInfo","userIsAdmin","cacheUserBasic","cacheTasks","cacheDialogs","wsOpenNum","columnTemplate","wsMsg","clientNewVersion","clientDownloadUrl","cacheTaskBrowse","dialogIns","reportUnreadNumber","approveUnreadNumber","okrWindow"]),...v(["dashboardTask"]),routeName(){return this.$route.name},okrUrl(){return{}.VITE_OKR_WEB_URL||$A.apiUrl("../apps/okr")},msgUnreadMention(){let t=0,s=0;this.cacheDialogs.some(e=>{t+=$A.getDialogUnread(e,!1),s+=$A.getDialogMention(e)}),t>999&&(t="999+"),s>999&&(s="999+");const a=this.msgTodoTotal;return a?s?`@${s}\xB7${a}`:t?`${t}\xB7${a}`:a:t?s?`${t}\xB7@${s}`:String(t):s?`@${s}`:""},msgAllUnread(){let t=0;return this.cacheDialogs.some(s=>{t+=$A.getDialogNum(s)}),t},msgTodoTotal(){let t=this.cacheDialogs.reduce((s,a)=>s+(a.todo_num||0),0);return t>0?(t>99?t="99+":t===1&&(t=""),`${this.$L("\u5F85\u529E")}${t}`):null},unreadAndOverdue(){return this.userId>0?this.msgAllUnread+this.dashboardTask.overdue_count:0},menu(){const{userIsAdmin:t,needStartHome:s}=this,a=[{path:"taskBrowse",name:"\u6700\u8FD1\u6253\u5F00\u7684\u4EFB\u52A1"}];return t?a.push({path:"personal",name:"\u4E2A\u4EBA\u8BBE\u7F6E",divided:!0},{path:"system",name:"\u7CFB\u7EDF\u8BBE\u7F6E"},{path:"license",name:"License Key"},{path:"version",name:"\u66F4\u65B0\u7248\u672C",divided:!0,visible:!!this.clientNewVersion},{path:"allProject",name:"\u6240\u6709\u9879\u76EE",divided:!0},{path:"archivedProject",name:"\u5DF2\u5F52\u6863\u7684\u9879\u76EE"},{path:"team",name:"\u56E2\u961F\u7BA1\u7406",divided:!0}):a.push({path:"personal",name:"\u4E2A\u4EBA\u8BBE\u7F6E",divided:!0},{path:"version",name:"\u66F4\u65B0\u7248\u672C",divided:!0,visible:!!this.clientNewVersion},{path:"workReport",name:"\u5DE5\u4F5C\u62A5\u544A",divided:!0},{path:"archivedProject",name:"\u5DF2\u5F52\u6863\u7684\u9879\u76EE"}),s?a.push({path:"goHome",name:"\u6253\u5F00\u9996\u9875",divided:!0},{path:"clearCache",name:"\u6E05\u9664\u7F13\u5B58"},{path:"logout",name:"\u9000\u51FA\u767B\u5F55",style:{color:"#f40"}}):a.push({path:"clearCache",name:"\u6E05\u9664\u7F13\u5B58",divided:!0},{path:"logout",name:"\u9000\u51FA\u767B\u5F55",style:{color:"#f40"}}),a},columns(){const t=$A.cloneJSON(this.columnTemplate);return t.unshift({name:this.$L("\u7A7A\u767D\u6A21\u677F"),columns:[]}),t},taskBrowseLists(){const{cacheTasks:t,cacheTaskBrowse:s,userId:a}=this;return s.filter(({userid:e})=>e===a).map(({id:e})=>t.find(n=>n.id===e)||{})},showMobileTabbar(){return this.routeName==="manage-project"&&!/^\d+$/.test(this.$route.params.projectId)?!0:["manage-dashboard","manage-messenger","manage-application"].includes(this.routeName)}},watch:{$route(){this.chackPass()},userInfo(){this.chackPass()},wsOpenNum(t){t<=1||this.$store.dispatch("getBasicData",600)},workReportShow(t){t&&this.$store.dispatch("getReportUnread",0)},unreadAndOverdue:{handler(t){this.$Electron&&this.$Electron.sendMessage("setDockBadge",t)},immediate:!0},wsMsg:{handler(t){const{type:s,action:a}=t;switch(s){case"report":a=="unreadUpdate"&&this.$store.dispatch("getReportUnread",1e3);break;case"approve":a=="unread"&&this.$store.dispatch("getApproveUnread",1e3);break}},deep:!0}},methods:{chackPass(){this.userInfo.changepass===1&&this.goForward({name:"manage-setting-password"})},async toggleRoute(t,s){this.showMobileMenu=!1;let a={name:"manage-"+t,params:s||{}},e=await $A.IDBInt("fileFolderId");t==="file"&&e>0&&(a.params.folderId=e),this.goForward(a)},settingRoute(t){switch(t){case"allUser":this.allUserShow=!0;return;case"allProject":this.allProjectShow=!0;return;case"archivedProject":this.archivedProjectShow=!0;return;case"exportTask":this.exportTaskShow=!0;return;case"exportOverdueTask":this.exportOverdueTask();return;case"exportCheckin":this.exportCheckinShow=!0;return;case"exportApprove":this.exportApproveShow=!0;return;case"workReport":this.reportUnreadNumber>0&&(this.reportTabs="receive"),this.workReportShow=!0;return;case"version":u.Store.set("updateNotification",null);return;case"clearCache":$A.IDBSet("clearCache","handle").then(s=>{$A.reloadUrl()});return;case"goHome":this.needStartHome&&this.goForward("index");return;case"approve":this.menu.findIndex(s=>s.path==t)>-1&&this.goForward({name:"manage-approve"});return;case"okrManage":case"okrAnalyze":this.goForward({path:"/manage/apps/"+(t=="okrManage"?"/#/list":"/#/analysis")});return;case"logout":$A.modalConfirm({title:"\u9000\u51FA\u767B\u5F55",content:"\u4F60\u786E\u5B9A\u8981\u767B\u51FA\u7CFB\u7EDF\uFF1F",onOk:()=>{this.$store.dispatch("logout",!1)}});return}this.menu.findIndex(s=>s.path==t)>-1&&this.toggleRoute("setting-"+t)},exportOverdueTask(){$A.modalConfirm({title:"\u5BFC\u51FA\u4EFB\u52A1",content:"\u4F60\u786E\u5B9A\u8981\u5BFC\u51FA\u6240\u6709\u8D85\u671F\u4EFB\u52A1\u5417\uFF1F",loading:!0,onOk:()=>new Promise((t,s)=>{this.$store.dispatch("call",{url:"project/task/exportoverdue"}).then(({data:a})=>{t(),this.$store.dispatch("downUrl",{url:a.url})}).catch(({msg:a})=>{s(a)})})})},menuVisibleChange(t){this.visibleMenu=t},classNameRoute(t){let s=this.routeName;return(s=="manage-approve"||s=="manage-apps"||s=="manage-calendar")&&(s="manage-application"),{active:s===`manage-${t}`}},onAddMenu(t){switch(t){case"task":this.onAddTask(0);break;case"createMeeting":u.Store.set("addMeeting",{type:"create",userids:[this.userId]});break;case"joinMeeting":u.Store.set("addMeeting",{type:"join"});break}},onAddShow(){this.$store.dispatch("getColumnTemplate").catch(()=>{}),this.addShow=!0,this.$nextTick(()=>{this.$refs.projectName.focus()})},onAddProject(){this.$refs.addProject.validate(t=>{t&&(this.loadIng++,this.$store.dispatch("call",{url:"project/add",data:this.addData}).then(({data:s,msg:a})=>{$A.messageSuccess(a),this.addShow=!1,this.$refs.addProject.resetFields(),this.$store.dispatch("saveProject",s),this.toggleRoute("project",{projectId:s.id})}).catch(({msg:s})=>{$A.modalError(s)}).finally(s=>{this.loadIng--}))})},selectChange(t){this.$nextTick(()=>{this.$set(this.addData,"columns",this.columns[t].columns.join(","))})},shortcutEvent(t){if(t.metaKey||t.ctrlKey)switch(t.keyCode){case 66:t.preventDefault(),this.onAddShow();break;case 74:t.preventDefault(),this.onAddMenu("createMeeting");break;case 75:case 78:t.preventDefault(),this.onAddMenu("task");break;case 83:this.$refs.taskModal.checkUpdate()&&t.preventDefault();break;case 188:t.preventDefault(),this.toggleRoute("setting");break}},onAddTask(t){this.addTaskShow=!0,this.$nextTick(s=>{let a={owner:[this.userId]};$A.isJson(t)?a=t:/^[1-9]\d*$/.test(t)&&(a.column_id=t),this.$refs.addTask.setData(a)})},openTask(t){this.$store.dispatch("openTask",t)},addDialogMsg(t){var b;if(!this.natificationReady&&!this.$isEEUiApp||this.windowActive&&t.dialog_id===((b=$A.last(this.dialogIns))==null?void 0:b.dialog_id))return;const{id:s,dialog_id:a,dialog_type:e,type:n,msg:i,userid:o}=t;if(o==this.userId)return;let r;switch(n){case"text":r=$A.getMsgTextPreview(i.text);break;case"file":r="["+this.$L(i.type=="img"?"\u56FE\u7247\u4FE1\u606F":"\u6587\u4EF6\u4FE1\u606F")+"]";break;default:return}this.__notificationId=s;const p=l=>{if(e==="group"){let f=this.cacheUserBasic.find(g=>g.userid==o);f?m(`${l} (${f.nickname})`):this.$store.dispatch("call",{url:"users/basic",data:{userid:[o]},skipAuthError:!0}).then(({data:g})=>{f=g.find(I=>I.userid==o),f&&m(`${l} (${f.nickname})`)}).catch(g=>{m(l)})}else m(l)},m=l=>{this.__notificationId===s&&(this.$isEEUiApp?this.$refs.mobileNotification.open({userid:o,title:l,desc:r,callback:()=>{this.goForward({name:"manage-messenger"}),this.$store.dispatch("openDialog",a)}}):this.$Electron?this.$Electron.sendMessage("openNotification",{icon:$A.originUrl("images/logo.png"),title:l,body:r,data:t,tag:"dialog",hasReply:!0,replyPlaceholder:this.$L("\u56DE\u590D\u6D88\u606F")}):(this.notificationManage.replaceOptions({icon:$A.originUrl("images/logo.png"),body:r,data:t,tag:"dialog"}),this.notificationManage.replaceTitle(l),this.notificationManage.userAgreed()))},_=this.cacheDialogs.find(l=>l.id==a);_?p(_.name):this.$store.dispatch("getDialogOne",a).then(({data:l})=>p(l.name)).catch(()=>{})},onTabbarClick(t){switch(t){case"addTask":this.onAddTask(0);break;case"addProject":this.onAddShow();break;case"allUser":case"workReport":this.settingRoute(t);break}},notificationInit(){this.notificationManage=new qt(this.$L("\u6253\u5F00\u901A\u77E5\u6210\u529F")),this.notificationManage.support&&(this.notificationManage.notificationEvent({onclick:({target:t})=>{console.log("[Notification] A Click",t),this.notificationManage.close(),this.notificationClick(t),window.focus()}}),this.notificationPermission()),this.$Electron&&(this.$Electron.registerMsgListener("clickNotification",t=>{console.log("[Notification] B Click",t),this.$Electron.sendMessage("mainWindowActive"),this.notificationClick(t)}),this.$Electron.registerMsgListener("replyNotification",t=>{console.log("[Notification] B Reply",t),this.notificationReply(t)}))},notificationPermission(){const t=s=>{switch(s){case"already granted":case"granted":return this.natificationReady=!0;case"close":return this.notificationManage.initNotification(t);case"denied":case"already denied":console.log(s==="denied"?"\u60A8\u521A\u521A\u62D2\u7EDD\u663E\u793A\u901A\u77E5 \u8BF7\u5728\u8BBE\u7F6E\u4E2D\u66F4\u6539\u8BBE\u7F6E":"\u60A8\u66FE\u7EA7\u62D2\u7EDD\u663E\u793A\u901A\u77E5 \u8BF7\u5728\u8BBE\u7F6E\u4E2D\u66F4\u6539\u8BBE\u7F6E");break}};this.notificationManage.initNotification(t)},notificationClick(t){const{tag:s,data:a}=t;if(s=="dialog"){if(!$A.isJson(a))return;this.goForward({name:"manage-messenger"}),this.$nextTick(e=>{this.$store.dispatch("openDialog",a.dialog_id)})}},notificationReply(t){const{tag:s,data:a,reply:e}=t;s=="dialog"&&e&&this.$store.dispatch("call",{url:"dialog/msg/sendtext",data:{dialog_id:a.dialog_id,text:e},method:"post"}).then(({data:n})=>{this.$store.dispatch("saveDialogMsg",n),this.$store.dispatch("increaseTaskMsgNum",n),this.$store.dispatch("increaseMsgReplyNum",n),this.$store.dispatch("updateDialogLastMsg",n)}).catch(({msg:n})=>{$A.modalError(n)})}}},S={};var Qt=d(Xt,Gt,Jt,!1,Zt,null,null,null);function Zt(t){for(let s in S)this[s]=S[s]}var fe=function(){return Qt.exports}();export{fe as default};
